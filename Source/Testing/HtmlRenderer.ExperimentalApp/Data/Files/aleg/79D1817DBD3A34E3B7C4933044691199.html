<!DOCTYPE HTML>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>[Lua] agwliststr = argv[1];  bgwliststr = argv[2];  aleg_no = argv[3];  bleg_no = argv - Pastebin.com</title>
		<link rel="shortcut icon" href="/favicon.ico" />
		<script src="/js/jquery.min.js"></script>
		<script src="/js/pastebin.min.v2.js"></script>

		<link href="/cache/css_lang/lua.css" rel="stylesheet" type="text/css" />		<link href="/i/pastebin.min.v4.css" rel="stylesheet" type="text/css" />
		<!--[if lt IE 10]>
			<link href="/i/pastebin.ie8.css" rel="stylesheet" type="text/css" />
		<![endif]-->

 
		<style>body{-webkit-text-size-adjust:none;}</style>
				<meta property="fb:app_id" content="231493360234820" />
		<meta property="og:title" content="[Lua] agwliststr = argv[1];  bgwliststr = argv[2];  aleg_no = argv[3];  bleg_no = argv - Pastebin.com" />
		<meta property="og:type" content="article" />
		<meta property="og:url" content="https://pastebin.com/14ba0tuf" />
		<meta property="og:image" content="https://pastebin.com/i/facebook.png" />
		<meta property="og:site_name" content="Pastebin" />
		<meta name="google-site-verification" content="jkUAIOE8owUXu8UXIhRLB9oHJsWBfOgJbZzncqHoF4A" />
		<link rel="canonical" href="https://pastebin.com/14ba0tuf" />
				<meta name="viewport" content="width=device-width, initial-scale=0.70, maximum-scale=1.0, user-scalable=yes">
		
		<script>
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

			ga('create', 'UA-58643-34', 'auto');
			ga('require', 'displayfeatures');
			ga('send', 'pageview');
		</script>
		<script type="text/javascript">
			if (top != self)
				top.location.href = location.href;
		</script>
<script data-cfasync="false" async src="https://pub.freestar.io/pastebin/pubfig.min.js"></script>	</head>
	<body>
	<div id="main_frame">
		<div id="jq-dropdown-1" class="jq-dropdown jq-dropdown-anchor-right jq-dropdown-scroll">
			<ul class="jq-dropdown-menu">
				
				<li class="lih_640">
					<form class="search_form_li" name="search_form_li" method="get" action="/search" id="cse-search-box-li">
						<input class="search_input_li" type="text" name="q" size="5" value="" placeholder="search..." />
					</form>

				</li>
				<li class="lih_div"></li>
				<li onclick="location.href='/signup'" class="dd_su">Sign Up</li>
				<li onclick="location.href='/login'" class="dd_lo">Login</li>
				<li class="lih_div"></li>
				<li onclick="location.href='/api'" class="lih_640">API</li>
				<li onclick="location.href='/faq'" class="lih_640">FAQ</li>
				<li onclick="location.href='/tools'" class="lih_640">Tools</li>
				<li onclick="location.href='/trends'" class="lih_640">Trends</li>
				<li onclick="location.href='/archive'" class="lih_640">Archive</li>			</ul>
		</div>
		<div id="header">
			<div id="header_wrap">
				<div id="header_top">
					<div id="header_logo" onclick="location.href='/'">PASTEBIN</div>
					<div id="header_new_paste" class="new_paste_button" onclick="location.href='/'">new paste</div>
					<div id="header_links">
						<a href="/trends">trends</a>
						<a href="/api" class="mmh">API</a>
						<a href="/tools" class="mmh">tools</a>
						<a href="/faq" class="mmh">faq</a>
					</div>
					<div id="header_search">
						<form class="search_form" name="search_form" method="get" action="/search" id="cse-search-box">
							<input class="search_input" type="text" name="q" size="5" value="" placeholder="search..." />
						</form>
					</div>
					
					<div id="header_members">
						<div id="header_dropdown" data-jq-dropdown="#jq-dropdown-1">&nbsp;</div>
						<div id="header_icon"><a href="/login"><img src="/i/guest.png" class="header_icon" alt="" /></a></div>
						<div id="header_user_frame">
							<div id="header_username">Guest User</div>
							<div id="header_user_status">-</div>
						</div>
						<div id="header_icons">
							<a href="/login" title="My Pastebin"><img src="/i/t.gif" class="header_icons hi_mypastebin" alt="" /></a>
							<a href="/messages" title="My Messages"><img src="/i/t.gif" class="header_icons hi_messages" alt="" /></a>
							<a href="/alerts" title="My Alerts"><img src="/i/t.gif" class="header_icons hi_alerts" alt="" /></a>
							<a href="/settings" title="My Settings"><img src="/i/t.gif" class="header_icons hi_settings" alt="" /></a>
						</div>
					</div>				</div>
			</div>
		</div>
		<div id="super_frame">
			<div id="monster_frame">
				<div id="content_frame">
					<div id="content_right">						
												<div class="content_right_menu">
									<div class="content_right_title"><a href="/archive">Public Pastes</a></div>
									<div id="menu_2">
										<ul class="right_menu"><li><a href="/4Ft2RxKg">prosz kacpr</a><span>3 sec ago</span></li><li><a href="/npeLtXNh">Untitled</a><span>PHP | 7 sec ago</span></li><li><a href="/ES7WPtVD">Untitled</a><span>Bash | 9 sec ago</span></li><li><a href="/PpC2TpbC">Amsterdam Server</a><span>14 sec ago</span></li><li><a href="/NaJE2UJy">YO MAMA</a><span>22 sec ago</span></li><li><a href="/rvUY9FVs">Untitled</a><span>24 sec ago</span></li><li><a href="/NzKMnwTA">Untitled</a><span>24 sec ago</span></li><li><a href="/qg6RkJUy">CS264 L1 Wray Chat</a><span>27 sec ago</span></li></ul></div></div>						<div id="abrpm2"></div>
						
			<div style="padding: 0; width:160px;margin: 10px 0;clear:left;">
				<script type="text/javascript"><!--
					e9 = new Object();
					e9.size = "160x600,120x600";
				//--></script>
				<script type="text/javascript" src="//tags.expo9.exponential.com/tags/Pastebincom/Safe/tags.js"></script>
			</div>						<div id="steadfast" title="Pastebin is proudly hosted by Steadfast.net" onclick="location.href='http://steadfast.net/?utm_source=pastebin.com&amp;utm_medium=referral&amp;utm_content=hosting_by_banner&amp;utm_campaign=referral_20140118_x_x_pastebin_partner&amp;source=referral_20140118_x_x_pastebin_partner'"></div>
					</div>
					<div id="content_left"><div id="ie_msg"></div>
		
	<div class="paste_box_frame">
		<div class="tweet h_800">
			<div onclick="facebookpopup('/14ba0tuf'); return false;" id="b_facebook2" title="Share on Facebook!"><span id="b_facebook">SHARE</span></div>
			<div onclick="twitpopup('/14ba0tuf'); return false;" id="b_twitter2" title="Share on Twitter!"><span id="b_twitter">TWEET</span></div>
		</div>
		<div class="paste_box_icon">
			<img src="/i/t.gif" class="i_gb" title="Anonymous guest user" alt="" />
		</div>
		<div class="paste_box_info">
			<div class="paste_box_line1" title="Untitled"><h1>Untitled</h1></div>
			<div class="paste_box_line2">
				<img src="/i/t.gif" class="img_line t_us" alt="" style="margin-left:0"> a guest 
				<img src="/i/t.gif" class="img_line t_da" alt=""> <span title="Sunday 11th of June 2017 07:46:32 AM CDT">Jun 11th, 2017</span>
				<img src="/i/t.gif" class="img_line t_vi" alt="" title="Unique visits to this paste"> 41
				<img src="/i/t.gif" class="img_line t_ex" alt="" title="When this paste gets automatically deleted"> Never
			</div>
		</div>
	</div>
	
			<div id="abrpm"></div>
			<div class="banner_728">
				<script type="text/javascript"><!--
					e9 = new Object();
					e9.size = "970x250,728x90";
				//--></script>
				<script type="text/javascript" src="//tags.expo9.exponential.com/tags/Pastebincom/Safe/tags.js"></script>
			</div>
			<div class="layout_clear"></div>
		<div class="content_text no_padding">
			<div id="notice" style="margin: 0 0 10px 0">
				<b>Not a member of Pastebin yet?</b> <a href="/signup"><b><u>Sign Up</u></b></a>, it unlocks many cool features!
			</div>
		</div>
	<div id="code_frame2">
		<div id="code_frame">
			<div id="code_buttons">
				<span class="go_right">
					<a href="/raw/14ba0tuf" class="buttonsm">raw</a><a href="/dl/14ba0tuf" class="buttonsm">download</a><a href="/index/14ba0tuf" class="buttonsm buttonhide">clone</a><a href="/embed/14ba0tuf" class="buttonsm buttonhide">embed</a><a href="/report/14ba0tuf" class="buttonsm">report</a><a href="/print/14ba0tuf" class="buttonsm buttonhide">print</a>
				</span>
				<span class="h_640"><a href="/archive/lua" class="buttonsm" style="margin:0">Lua</a></span> 5.74 KB
			</div>
			<div id="selectable">
				<ol class="lua"><li class="li1"><div class="de1">agwliststr <span class="sy0">=</span> argv<span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">bgwliststr <span class="sy0">=</span> argv<span class="br0">&#91;</span><span class="nu0">2</span><span class="br0">&#93;</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">aleg_no <span class="sy0">=</span> argv<span class="br0">&#91;</span><span class="nu0">3</span><span class="br0">&#93;</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">bleg_no <span class="sy0">=</span> argv<span class="br0">&#91;</span><span class="nu0">4</span><span class="br0">&#93;</span><span class="sy0">;</span> </div></li>
<li class="li2"><div class="de2">aleg_cost <span class="sy0">=</span> argv<span class="br0">&#91;</span><span class="nu0">5</span><span class="br0">&#93;</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">bleg_cost <span class="sy0">=</span> argv<span class="br0">&#91;</span><span class="nu0">6</span><span class="br0">&#93;</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">costing_accnt <span class="sy0">=</span> argv<span class="br0">&#91;</span><span class="nu0">7</span><span class="br0">&#93;</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1"><span class="co1">--extradialaparams = arg[8]</span></div></li>
<li class="li1"><div class="de1"><span class="co1">--extradialbparams = arg[9]</span></div></li>
<li class="li2"><div class="de2">aleg_cli <span class="sy0">=</span> argv<span class="br0">&#91;</span><span class="nu0">8</span><span class="br0">&#93;</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">freeswitch<span class="sy0">.</span>consoleLog<span class="br0">&#40;</span><span class="st0">&quot;notice&quot;</span><span class="sy0">,</span> <span class="st0">&quot;*****&quot;</span><span class="sy0">..</span>agwliststr<span class="sy0">..</span><span class="st0">&quot;*****&quot;</span><span class="sy0">..</span>bgwliststr<span class="sy0">..</span><span class="st0">&quot;****<span class="es1">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp;</div></li>
<li class="li1"><div class="de1">snd_path <span class="sy0">=</span> <span class="st0">&quot;/usr/local/freeswitch/sounds/miglu/&quot;</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">greeting_snd <span class="sy0">=</span> snd_path<span class="sy0">..</span><span class="st0">&quot;callback.wav&quot;</span><span class="sy0">;</span></div></li>
<li class="li2"><div class="de2">connecting_snd <span class="sy0">=</span> snd_path<span class="sy0">..</span><span class="st0">&quot;miglu_connecting_your_call.wav&quot;</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">sorry_snd <span class="sy0">=</span> snd_path<span class="sy0">..</span><span class="st0">&quot;sorry.wav&quot;</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp;</div></li>
<li class="li1"><div class="de1">agwlist_count <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">agw_list <span class="sy0">=</span> <span class="br0">&#123;</span><span class="br0">&#125;</span><span class="sy0">;</span></div></li>
<li class="li2"><div class="de2">&nbsp;</div></li>
<li class="li1"><div class="de1"><span class="kw1">for</span> gw <span class="kw2">in</span> <span class="kw3">string</span><span class="sy0">.</span>gmatch<span class="br0">&#40;</span>agwliststr<span class="sy0">,</span> <span class="st0">&quot;[^,]+&quot;</span><span class="br0">&#41;</span> <span class="kw1">do</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; agw_list<span class="br0">&#91;</span>agwlist_count<span class="br0">&#93;</span> <span class="sy0">=</span> gw <span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; agwlist_count <span class="sy0">=</span> agwlist_count <span class="sy0">+</span> <span class="nu0">1</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1"><span class="kw1">end</span></div></li>
<li class="li2"><div class="de2">&nbsp;</div></li>
<li class="li1"><div class="de1">&nbsp;</div></li>
<li class="li1"><div class="de1">bgwlist_count <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">bgw_list <span class="sy0">=</span> <span class="br0">&#123;</span><span class="br0">&#125;</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp;</div></li>
<li class="li2"><div class="de2"><span class="kw1">for</span> gw <span class="kw2">in</span> <span class="kw3">string</span><span class="sy0">.</span>gmatch<span class="br0">&#40;</span>bgwliststr<span class="sy0">,</span> <span class="st0">&quot;[^,]+&quot;</span><span class="br0">&#41;</span> <span class="kw1">do</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; bgw_list<span class="br0">&#91;</span>bgwlist_count<span class="br0">&#93;</span> <span class="sy0">=</span> gw <span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; bgwlist_count <span class="sy0">=</span> bgwlist_count <span class="sy0">+</span> <span class="nu0">1</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1"><span class="kw1">end</span></div></li>
<li class="li1"><div class="de1">&nbsp;</div></li>
<li class="li2"><div class="de2">&nbsp;</div></li>
<li class="li1"><div class="de1">&nbsp;</div></li>
<li class="li1"><div class="de1">&nbsp;</div></li>
<li class="li1"><div class="de1">freeswitch<span class="sy0">.</span>consoleLog<span class="br0">&#40;</span><span class="st0">&quot;notice&quot;</span><span class="sy0">,</span> <span class="st0">&quot;*****&quot;</span><span class="sy0">..</span>agwlist_count<span class="br0">&#41;</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp;</div></li>
<li class="li2"><div class="de2">max_gw_retries <span class="sy0">=</span> <span class="nu0">4</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp;</div></li>
<li class="li1"><div class="de1"><span class="co1">--originate_base1 = &quot;{origination_caller_id_number=&quot;..bleg_no..&quot;,ignore_early_media=true,absolute_codec_string='G729,PCMA,PCMU',originate_timeout=60,hangup_after_bridge=true,leg=1,nibble_rate=&quot;..aleg_cost..&quot;,nibble_account=&quot;..costing_accnt..&quot;}sofia/gateway/&quot;;</span></div></li>
<li class="li1"><div class="de1">originate_base1 <span class="sy0">=</span> <span class="st0">&quot;{origination_caller_id_number=&quot;</span><span class="sy0">..</span>aleg_cli<span class="sy0">..</span><span class="st0">&quot;,origination_caller_id_name=Miglu,bridge_early_media=true,absolute_codec_string='G729,PCMU,PCMA',originate_timeout=60,hangup_after_bridge=true,callleg=First,servicetype=WebCall,called_num=&quot;</span><span class="sy0">..</span>aleg_no<span class="sy0">..</span><span class="st0">&quot;,nibble_rate=&quot;</span><span class="sy0">..</span>aleg_cost<span class="sy0">..</span><span class="st0">&quot;,nibble_account=&quot;</span><span class="sy0">..</span>costing_accnt<span class="sy0">..</span><span class="st0">&quot;}sofia/gateway/&quot;</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp;</div></li>
<li class="li2"><div class="de2">gwretries <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">currentgw_no <span class="sy0">=</span><span class="nu0">0</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">session1 <span class="sy0">=</span> null<span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">adisconnected <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp;</div></li>
<li class="li2"><div class="de2"><span class="co1">-- call alegno, using every gw in the list, and try each gw for max_gw_retries no of times</span></div></li>
<li class="li1"><div class="de1"><span class="kw1">while</span> <span class="br0">&#40;</span>currentgw_no <span class="sy0">&lt;</span> agwlist_count<span class="br0">&#41;</span> <span class="kw1">do</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; </div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; gw <span class="sy0">=</span> agw_list<span class="br0">&#91;</span>currentgw_no<span class="br0">&#93;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; gwretries <span class="sy0">=</span> gwretries <span class="sy0">+</span> <span class="nu0">1</span><span class="sy0">;</span></div></li>
<li class="li2"><div class="de2">&nbsp; &nbsp; dialstr1 <span class="sy0">=</span> originate_base1<span class="sy0">..</span>gw<span class="sy0">..</span>aleg_no<span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; </div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; freeswitch<span class="sy0">.</span>consoleLog<span class="br0">&#40;</span><span class="st0">&quot;notice&quot;</span><span class="sy0">,</span> <span class="st0">&quot;<span class="es1">\n</span><span class="es1">\n</span>*********** DIALING &quot;</span><span class="sy0">..</span>dialstr1<span class="sy0">..</span><span class="st0">&quot;****Try no***&quot;</span><span class="sy0">..</span>gwretries<span class="sy0">..</span><span class="st0">&quot; ***********<span class="es1">\n</span><span class="es1">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; session1 <span class="sy0">=</span> freeswitch<span class="sy0">.</span>Session<span class="br0">&#40;</span>dialstr1<span class="br0">&#41;</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; </div></li>
<li class="li2"><div class="de2">&nbsp; &nbsp; </div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">&#40;</span>session1<span class="sy0">:</span>ready<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="kw1">then</span> <span class="kw1">break</span> <span class="kw1">end</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; </div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="kw1">local</span> hcause <span class="sy0">=</span> session1<span class="sy0">:</span>hangupCause<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; </div></li>
<li class="li2"><div class="de2">&nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">&#40;</span>hcause <span class="sy0">==</span> <span class="st0">'USER_BUSY'</span><span class="br0">&#41;</span> <span class="kw1">then</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; &nbsp; &nbsp; adisconnected <span class="sy0">=</span> adisconnected <span class="sy0">+</span> <span class="nu0">1</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="kw1">end</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; </div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">&#40;</span>hcause <span class="sy0">==</span> <span class="st0">'NO_USER_RESPONSE'</span><span class="br0">&#41;</span> <span class="kw1">then</span></div></li>
<li class="li2"><div class="de2">&nbsp; &nbsp; &nbsp; &nbsp; adisconnected <span class="sy0">=</span> adisconnected <span class="sy0">+</span> <span class="nu0">1</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="kw1">end</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; </div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">&#40;</span>hcause <span class="sy0">==</span> <span class="st0">'ORIGINATOR_CANCEL'</span><span class="br0">&#41;</span> <span class="kw1">then</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; &nbsp; &nbsp; adisconnected <span class="sy0">=</span> adisconnected <span class="sy0">+</span> <span class="nu0">1</span><span class="sy0">;</span></div></li>
<li class="li2"><div class="de2">&nbsp; &nbsp; <span class="kw1">end</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; </div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">&#40;</span>hcause <span class="sy0">==</span> <span class="st0">'NO_ANSWER'</span><span class="br0">&#41;</span> <span class="kw1">then</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; &nbsp; &nbsp; adisconnected <span class="sy0">=</span> adisconnected <span class="sy0">+</span> <span class="nu0">1</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="kw1">end</span></div></li>
<li class="li2"><div class="de2">&nbsp; &nbsp; </div></li>
<li class="li1"><div class="de1">&nbsp;</div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">&#40;</span>adisconnected <span class="sy0">==</span> <span class="nu0">3</span><span class="br0">&#41;</span> <span class="kw1">then</span> <span class="kw1">break</span> <span class="kw1">end</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; </div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; freeswitch<span class="sy0">.</span>consoleLog<span class="br0">&#40;</span><span class="st0">&quot;notice&quot;</span><span class="sy0">,</span> <span class="st0">&quot;<span class="es1">\n</span><span class="es1">\n</span>*********** Leg1: &quot;</span> <span class="sy0">..</span> hcause <span class="sy0">..</span> <span class="st0">&quot; ***GWNo***&quot;</span><span class="sy0">..</span>currentgw_no<span class="sy0">..</span><span class="st0">&quot;***GWList**&quot;</span><span class="sy0">..</span>agwlist_count<span class="sy0">..</span><span class="st0">&quot;**<span class="es1">\n</span><span class="es1">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li>
<li class="li2"><div class="de2">&nbsp;</div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">&#40;</span>gwretries <span class="sy0">==</span> max_gw_retries<span class="br0">&#41;</span> <span class="kw1">then</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; &nbsp; &nbsp; gwretries <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; &nbsp; &nbsp; currentgw_no <span class="sy0">=</span> currentgw_no <span class="sy0">+</span> <span class="nu0">1</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="kw1">end</span></div></li>
<li class="li2"><div class="de2">&nbsp;</div></li>
<li class="li1"><div class="de1"><span class="kw1">end</span></div></li>
<li class="li1"><div class="de1">&nbsp;</div></li>
<li class="li1"><div class="de1">freeswitch<span class="sy0">.</span>consoleLog<span class="br0">&#40;</span><span class="st0">&quot;notice&quot;</span><span class="sy0">,</span> <span class="st0">&quot;<span class="es1">\n</span><span class="es1">\n</span>*******Comes Here 1**&quot;</span><span class="sy0">..</span>session1<span class="sy0">:</span>getVariable<span class="br0">&#40;</span><span class="st0">&quot;caller_id_number&quot;</span><span class="br0">&#41;</span><span class="sy0">..</span><span class="st0">&quot;*<span class="es1">\n</span><span class="es1">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1"><span class="co1">-- call blegno, using every gw in the list, and try each gw for max_gw_retries no of times</span></div></li>
<li class="li2"><div class="de2"><span class="kw1">if</span> <span class="br0">&#40;</span>session1<span class="sy0">:</span>ready<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="kw1">then</span></div></li>
<li class="li1"><div class="de1">&nbsp;</div></li>
<li class="li1"><div class="de1"><span class="co1">-- in future to be able to dial an extension, detect phone pickup and send extension as dtmf</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; uuid <span class="sy0">=</span> session1<span class="sy0">:</span>getVariable<span class="br0">&#40;</span><span class="st0">&quot;uuid&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; </div></li>
<li class="li2"><div class="de2">&nbsp; &nbsp; <span class="co1">--session1:setVariable(&quot;instant_ringback&quot;, &quot;%(2000,4000,440,480)&quot;);</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="co1">--session1:setVariable(&quot;transfer_ringback&quot;, &quot;%(2000,4000,440,480)&quot;);</span></div></li>
<li class="li1"><div class="de1">&nbsp;</div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; originate_base2 <span class="sy0">=</span> <span class="st0">&quot;{origination_caller_id_number=&quot;</span><span class="sy0">..</span>aleg_no<span class="sy0">..</span><span class="st0">&quot;,origination_caller_id_name=Miglu,bridge_early_media=true,absolute_codec_string='G729,PCMU,PCMA',originate_timeout=60,hangup_after_bridge=true,uuid=&quot;</span><span class="sy0">..</span>uuid<span class="sy0">..</span><span class="st0">&quot;,callleg=Second,servicetype=WebCall,called_num=&quot;</span><span class="sy0">..</span>bleg_no<span class="sy0">..</span><span class="st0">&quot;,nibble_rate=&quot;</span><span class="sy0">..</span>bleg_cost<span class="sy0">..</span><span class="st0">&quot;,nibble_account=&quot;</span><span class="sy0">..</span>costing_accnt<span class="sy0">..</span><span class="st0">&quot;}sofia/gateway/&quot;</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp;</div></li>
<li class="li2"><div class="de2">&nbsp; &nbsp; </div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; gwretries <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; currentgw_no <span class="sy0">=</span><span class="nu0">0</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; session2 <span class="sy0">=</span> null<span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; </div></li>
<li class="li2"><div class="de2">&nbsp; &nbsp; </div></li>
<li class="li1"><div class="de1">freeswitch<span class="sy0">.</span>consoleLog<span class="br0">&#40;</span><span class="st0">&quot;notice&quot;</span><span class="sy0">,</span> <span class="st0">&quot;<span class="es1">\n</span><span class="es1">\n</span>*******Comes Here 2***<span class="es1">\n</span><span class="es1">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>&nbsp; </div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; </div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; session1<span class="sy0">:</span>sleep<span class="br0">&#40;</span><span class="nu0">1000</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; session1<span class="sy0">:</span><span class="kw3">execute</span><span class="br0">&#40;</span><span class="st0">&quot;playback&quot;</span><span class="sy0">,</span> connecting_snd<span class="br0">&#41;</span><span class="sy0">;</span></div></li>
<li class="li2"><div class="de2">&nbsp;</div></li>
<li class="li1"><div class="de1">&nbsp;<span class="kw1">while</span> <span class="br0">&#40;</span>currentgw_no <span class="sy0">&lt;</span> bgwlist_count<span class="br0">&#41;</span> <span class="kw1">do</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; </div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; gw <span class="sy0">=</span> bgw_list<span class="br0">&#91;</span>currentgw_no<span class="br0">&#93;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; gwretries <span class="sy0">=</span> gwretries <span class="sy0">+</span> <span class="nu0">1</span><span class="sy0">;</span></div></li>
<li class="li2"><div class="de2">&nbsp; &nbsp; dialstr2 <span class="sy0">=</span> originate_base2<span class="sy0">..</span>gw<span class="sy0">..</span>bleg_no<span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; </div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; freeswitch<span class="sy0">.</span>consoleLog<span class="br0">&#40;</span><span class="st0">&quot;notice&quot;</span><span class="sy0">,</span> <span class="st0">&quot;<span class="es1">\n</span><span class="es1">\n</span>*********** DIALING ****Just before originate***&quot;</span><span class="sy0">..</span>gwretries<span class="sy0">..</span><span class="st0">&quot; ***********<span class="es1">\n</span><span class="es1">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="co1">--session1:execute(&quot;bridge&quot;, dialstr2); </span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; session2 <span class="sy0">=</span> freeswitch<span class="sy0">.</span>Session<span class="br0">&#40;</span>dialstr2<span class="sy0">,</span> session1<span class="br0">&#41;</span><span class="sy0">;</span></div></li>
<li class="li2"><div class="de2">&nbsp; &nbsp; freeswitch<span class="sy0">.</span>consoleLog<span class="br0">&#40;</span><span class="st0">&quot;notice&quot;</span><span class="sy0">,</span> <span class="st0">&quot;<span class="es1">\n</span><span class="es1">\n</span>*********** DIALING ****just before the bridge***&quot;</span><span class="sy0">..</span>gwretries<span class="sy0">..</span><span class="st0">&quot; ***********<span class="es1">\n</span><span class="es1">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; s</div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="co1">--if (session1:bridged()) then break end</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">&#40;</span>session2<span class="sy0">:</span>ready<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="kw1">then</span> <span class="kw1">break</span> <span class="kw1">end</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; freeswitch<span class="sy0">.</span>consoleLog<span class="br0">&#40;</span><span class="st0">&quot;notice&quot;</span><span class="sy0">,</span> <span class="st0">&quot;<span class="es1">\n</span><span class="es1">\n</span>*********** DIALING ****after the bridge***&quot;</span><span class="sy0">..</span>gwretries<span class="sy0">..</span><span class="st0">&quot; ***********<span class="es1">\n</span><span class="es1">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li>
<li class="li2"><div class="de2">&nbsp; &nbsp; </div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="kw1">local</span> hcause <span class="sy0">=</span> session2<span class="sy0">:</span>hangupCause<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; </div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">&#40;</span>hcause <span class="sy0">==</span> <span class="st0">'USER_BUSY'</span><span class="br0">&#41;</span> <span class="kw1">then</span> <span class="kw1">break</span> <span class="kw1">end</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; </div></li>
<li class="li2"><div class="de2">&nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">&#40;</span>hcause <span class="sy0">==</span> <span class="st0">'ORIGINATOR_CANCEL'</span><span class="br0">&#41;</span> <span class="kw1">then</span> <span class="kw1">break</span> <span class="kw1">end</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; </div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="co1">--freeswitch.consoleLog(&quot;notice&quot;, &quot;\n\n*********** Leg1: &quot; .. hcause .. &quot; ***GWNo***&quot;..currentgw_no..&quot;***GWList**&quot;..bgwlist_count..&quot;**\n\n&quot;);</span></div></li>
<li class="li1"><div class="de1">&nbsp;</div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">&#40;</span>gwretries <span class="sy0">==</span> max_gw_retries<span class="br0">&#41;</span> <span class="kw1">then</span></div></li>
<li class="li2"><div class="de2">&nbsp; &nbsp; &nbsp; &nbsp; gwretries <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; &nbsp; &nbsp; currentgw_no <span class="sy0">=</span> currentgw_no <span class="sy0">+</span> <span class="nu0">1</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="kw1">end</span></div></li>
<li class="li1"><div class="de1">&nbsp;</div></li>
<li class="li1"><div class="de1"><span class="kw1">end</span></div></li>
<li class="li2"><div class="de2">&nbsp;</div></li>
<li class="li1"><div class="de1">freeswitch<span class="sy0">.</span>consoleLog<span class="br0">&#40;</span><span class="st0">&quot;notice&quot;</span><span class="sy0">,</span> <span class="st0">&quot;<span class="es1">\n</span><span class="es1">\n</span>*******Comes Here 5***<span class="es1">\n</span><span class="es1">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>&nbsp; </div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="co1">--</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">&#40;</span>session2<span class="sy0">:</span>ready<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="kw1">then</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; &nbsp; &nbsp; freeswitch<span class="sy0">.</span>consoleLog<span class="br0">&#40;</span><span class="st0">&quot;notice&quot;</span><span class="sy0">,</span> <span class="st0">&quot;*********** Leg2 CONNECTED!*****&quot;</span><span class="sy0">..</span>session2<span class="sy0">:</span>getVariable<span class="br0">&#40;</span><span class="st0">&quot;caller_id_number&quot;</span><span class="br0">&#41;</span><span class="sy0">..</span><span class="st0">&quot;********<span class="es1">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li>
<li class="li2"><div class="de2">&nbsp; &nbsp; &nbsp; &nbsp;freeswitch<span class="sy0">.</span>bridge<span class="br0">&#40;</span>session1<span class="sy0">,</span> session2<span class="br0">&#41;</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; </div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; &nbsp; &nbsp;<span class="co1">-- Hangup session2 if session1 is over</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; &nbsp; &nbsp;<span class="kw1">if</span> <span class="br0">&#40;</span>session2<span class="sy0">:</span>ready<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="kw1">then</span> session2<span class="sy0">:</span>hangup<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span> <span class="kw1">end</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; </div></li>
<li class="li2"><div class="de2">&nbsp; &nbsp; <span class="co1">--else</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="co1">--&nbsp; if (session2:hangupCause() == 'USER_BUSY') then</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="co1">--&nbsp; &nbsp; &nbsp; freeswitch.consoleLog(&quot;notice&quot;, &quot;*********** Leg 2 - USER BUSY! ***********\n&quot;);</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="co1">--&nbsp; &nbsp; &nbsp; session1:execute(&quot;playback&quot;, sorry_snd);</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="co1">--&nbsp; else</span></div></li>
<li class="li2"><div class="de2">&nbsp; &nbsp; <span class="co1">--&nbsp; &nbsp; &nbsp; freeswitch.consoleLog(&quot;notice&quot;, &quot;*********** LEG 2 &nbsp;- Call Cannot be connected ***********\n&quot;);</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="co1">--&nbsp; &nbsp; &nbsp; session1:execute(&quot;playback&quot;, sorry_snd);</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="co1">--&nbsp; end</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="co1">--&nbsp; session1:hangup();</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; </div></li>
<li class="li2"><div class="de2">&nbsp; &nbsp; <span class="kw1">end</span></div></li>
<li class="li1"><div class="de1">&nbsp;</div></li>
<li class="li1"><div class="de1">&nbsp;</div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="co1">-- hangup when done</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">&#40;</span>session1<span class="sy0">:</span>ready<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="kw1">then</span> session1<span class="sy0">:</span>hangup<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span> <span class="kw1">end</span></div></li>
<li class="li2"><div class="de2"><span class="kw1">end</span></div></li>
<li class="li1"><div class="de1">&nbsp;</div></li>
<li class="li1"><div class="de1">freeswitch<span class="sy0">.</span>consoleLog<span class="br0">&#40;</span><span class="st0">&quot;notice&quot;</span><span class="sy0">,</span> <span class="st0">&quot;<span class="es1">\n</span><span class="es1">\n</span>*******Comes Here 3***<span class="es1">\n</span><span class="es1">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li>
</ol>
			</div>
		</div>
	</div>
	<div class="content_title no_border">RAW Paste Data<div id="bsa-footer"></div></div>
	<div class="textarea_border" style="margin-bottom:0">
		<textarea id="paste_code" class="paste_code" name="paste_code" onkeydown="return catchTab(this,event)">agwliststr = argv[1];
bgwliststr = argv[2];
aleg_no = argv[3];
bleg_no = argv[4]; 
aleg_cost = argv[5];
bleg_cost = argv[6];
costing_accnt = argv[7];
--extradialaparams = arg[8]
--extradialbparams = arg[9]
aleg_cli = argv[8];
freeswitch.consoleLog("notice", "*****"..agwliststr.."*****"..bgwliststr.."****\n");

snd_path = "/usr/local/freeswitch/sounds/miglu/";
greeting_snd = snd_path.."callback.wav";
connecting_snd = snd_path.."miglu_connecting_your_call.wav";
sorry_snd = snd_path.."sorry.wav";

agwlist_count = 0;
agw_list = {};

for gw in string.gmatch(agwliststr, "[^,]+") do
	agw_list[agwlist_count] = gw ;
	agwlist_count = agwlist_count + 1;
end


bgwlist_count = 0;
bgw_list = {};

for gw in string.gmatch(bgwliststr, "[^,]+") do
	bgw_list[bgwlist_count] = gw ;
	bgwlist_count = bgwlist_count + 1;
end




freeswitch.consoleLog("notice", "*****"..agwlist_count);

max_gw_retries = 4;

--originate_base1 = "{origination_caller_id_number="..bleg_no..",ignore_early_media=true,absolute_codec_string='G729,PCMA,PCMU',originate_timeout=60,hangup_after_bridge=true,leg=1,nibble_rate="..aleg_cost..",nibble_account="..costing_accnt.."}sofia/gateway/";
originate_base1 = "{origination_caller_id_number="..aleg_cli..",origination_caller_id_name=Miglu,bridge_early_media=true,absolute_codec_string='G729,PCMU,PCMA',originate_timeout=60,hangup_after_bridge=true,callleg=First,servicetype=WebCall,called_num="..aleg_no..",nibble_rate="..aleg_cost..",nibble_account="..costing_accnt.."}sofia/gateway/";

gwretries = 0;
currentgw_no =0;
session1 = null;
adisconnected = 0;

-- call alegno, using every gw in the list, and try each gw for max_gw_retries no of times
while (currentgw_no &lt; agwlist_count) do
	
	gw = agw_list[currentgw_no]
	gwretries = gwretries + 1;
	dialstr1 = originate_base1..gw..aleg_no;
	
	freeswitch.consoleLog("notice", "\n\n*********** DIALING "..dialstr1.."****Try no***"..gwretries.." ***********\n\n");
	session1 = freeswitch.Session(dialstr1);
	
	
	if (session1:ready()) then break end
	
	local hcause = session1:hangupCause();
	
	if (hcause == 'USER_BUSY') then
		adisconnected = adisconnected + 1;
	end
	
	if (hcause == 'NO_USER_RESPONSE') then
		adisconnected = adisconnected + 1;
	end
	
	if (hcause == 'ORIGINATOR_CANCEL') then
		adisconnected = adisconnected + 1;
	end
	
	if (hcause == 'NO_ANSWER') then
		adisconnected = adisconnected + 1;
	end
	

	if (adisconnected == 3) then break end
	
	freeswitch.consoleLog("notice", "\n\n*********** Leg1: " .. hcause .. " ***GWNo***"..currentgw_no.."***GWList**"..agwlist_count.."**\n\n");

	if (gwretries == max_gw_retries) then
		gwretries = 0;
		currentgw_no = currentgw_no + 1;
	end

end

freeswitch.consoleLog("notice", "\n\n*******Comes Here 1**"..session1:getVariable("caller_id_number").."*\n\n");
-- call blegno, using every gw in the list, and try each gw for max_gw_retries no of times
if (session1:ready()) then

-- in future to be able to dial an extension, detect phone pickup and send extension as dtmf
	uuid = session1:getVariable("uuid");
	
	--session1:setVariable("instant_ringback", "%(2000,4000,440,480)");
	--session1:setVariable("transfer_ringback", "%(2000,4000,440,480)");

	originate_base2 = "{origination_caller_id_number="..aleg_no..",origination_caller_id_name=Miglu,bridge_early_media=true,absolute_codec_string='G729,PCMU,PCMA',originate_timeout=60,hangup_after_bridge=true,uuid="..uuid..",callleg=Second,servicetype=WebCall,called_num="..bleg_no..",nibble_rate="..bleg_cost..",nibble_account="..costing_accnt.."}sofia/gateway/";

	
	gwretries = 0;
	currentgw_no =0;
	session2 = null;
	
	
freeswitch.consoleLog("notice", "\n\n*******Comes Here 2***\n\n");	
	
	session1:sleep(1000);
	session1:execute("playback", connecting_snd);

 while (currentgw_no &lt; bgwlist_count) do
	
	gw = bgw_list[currentgw_no]
	gwretries = gwretries + 1;
	dialstr2 = originate_base2..gw..bleg_no;
	
	freeswitch.consoleLog("notice", "\n\n*********** DIALING ****Just before originate***"..gwretries.." ***********\n\n");
	--session1:execute("bridge", dialstr2); 
	session2 = freeswitch.Session(dialstr2, session1);
	freeswitch.consoleLog("notice", "\n\n*********** DIALING ****just before the bridge***"..gwretries.." ***********\n\n");
	s
	--if (session1:bridged()) then break end
	if (session2:ready()) then break end
	freeswitch.consoleLog("notice", "\n\n*********** DIALING ****after the bridge***"..gwretries.." ***********\n\n");
	
	local hcause = session2:hangupCause();
	
	if (hcause == 'USER_BUSY') then break end
	
	if (hcause == 'ORIGINATOR_CANCEL') then break end
	
	--freeswitch.consoleLog("notice", "\n\n*********** Leg1: " .. hcause .. " ***GWNo***"..currentgw_no.."***GWList**"..bgwlist_count.."**\n\n");

	if (gwretries == max_gw_retries) then
		gwretries = 0;
		currentgw_no = currentgw_no + 1;
	end

end

freeswitch.consoleLog("notice", "\n\n*******Comes Here 5***\n\n");	
	--
	if (session2:ready()) then
	    freeswitch.consoleLog("notice", "*********** Leg2 CONNECTED!*****"..session2:getVariable("caller_id_number").."********\n");
	   freeswitch.bridge(session1, session2);
	
	   -- Hangup session2 if session1 is over
	   if (session2:ready()) then session2:hangup(); end
	
	--else
	--	if (session2:hangupCause() == 'USER_BUSY') then
	--		freeswitch.consoleLog("notice", "*********** Leg 2 - USER BUSY! ***********\n");
	--		session1:execute("playback", sorry_snd);
	--	else
	--		freeswitch.consoleLog("notice", "*********** LEG 2  - Call Cannot be connected ***********\n");
	--		session1:execute("playback", sorry_snd);
	--	end
	--	session1:hangup();
	
	end


	-- hangup when done
	if (session1:ready()) then session1:hangup(); end
end

freeswitch.consoleLog("notice", "\n\n*******Comes Here 3***\n\n");</textarea>
	</div><div id="abrpm3"></div>
			<div style="padding: 10px 0 0 0;">
				<script type="text/javascript"><!--
					e9 = new Object();
					e9.size = "300x600,300x250";
				//--></script>
				<script type="text/javascript" src="//tags.expo9.exponential.com/tags/Pastebincom/Safe/tags.js"></script>
			</div>
				<style>.promo-bar { padding: 13px 13px 13px 13px;}#paypal_promo_img {background: #fff;width: 60px;height: 50px;float: left;}</style>
				<script type="text/javascript">$(document).ready(function(){$(".close").click(function(){return $("#paypal-overlay").hide(),createCookie("l2c",!0,1),!1})});</script>
				<div id="paypal-overlay" class="promo-bar"> 
				<div id="paypal_promo_img"><a href="/pro" target="_blank"><img src="https://i.imgur.com/LQE4W06.png" alt="" border="0" style="width:48px;height:48px;" /></a></div> 
				<div id="paypal_promo_text">Pastebin PRO Summer Special!<br /><a href="/pro" target="_blank" style="text-decoration: underline dotted">Get 60% OFF on Pastebin PRO accounts!</a></div>
					<a id="paypal-overlay-close" class="close"></a>
				</div>						</div>
					</div>
				</div>
			</div>
			<div id="mid_footer">
				<a href="/tools#chrome" title="Google Chrome Extension"><img src="/i/t.gif" alt="" class="icon24 chrome" /></a>
				<a href="/tools#firefox" title="Firefox Extension"><img src="/i/t.gif" alt="" class="icon24 firefox" /></a>
				<a href="/tools#iphone" title="iPhone/iPad Application"><img src="/i/t.gif" alt="" class="icon24 iphone" /></a>
				<a href="/tools#windows" title="Windows Desktop Application"><img src="/i/t.gif" alt="" class="icon24 windows" /></a>
				<a href="/tools#webos" title="webOS Application"><img src="/i/t.gif" alt="" class="icon24 webos" /></a>
				<a href="/tools#android" title="Android Application"><img src="/i/t.gif" alt="" class="icon24 android" /></a>
				<a href="/tools#macos" title="MacOS X Widget"><img src="/i/t.gif" alt="" class="icon24 macos" /></a>
				<a href="/tools#opera" title="Opera Extension"><img src="/i/t.gif" alt="" class="icon24 opera" /></a>
				<a href="/tools#pastebincl" title="Linux Application"><img src="/i/t.gif" alt="" class="icon24 unix" /></a>
			</div> 
		</div>
		<div id="footer">
			<div id="footer_links">
				<a href="/">create new paste</a> &nbsp;/&nbsp; <a href="https://deals.pastebin.com">deals</a><sup style="color:red">new!</sup> &nbsp;/&nbsp; <a href="/api">api</a> &nbsp;/&nbsp; <a href="/trends">trends</a> &nbsp;/&nbsp; <a href="/languages">syntax languages</a> &nbsp;/&nbsp; <a href="/faq">faq</a> &nbsp;/&nbsp; <a href="/tools">tools</a> &nbsp;/&nbsp; <a href="/privacy">privacy</a> &nbsp;/&nbsp; <a href="/cookies_policy">cookies</a> &nbsp;/&nbsp; <a href="/contact">contact</a> &nbsp;/&nbsp; <a href="/dmca">dmca</a> &nbsp;/&nbsp; <a href="/scraping">scraping</a>   &nbsp;/&nbsp; <a href="/pro">go <img src="/i/t.gif" alt="" title="Get a PRO account!" class="pro_btn_inv" /></a>
				<br /><span class="h_800">Site design &amp; logo &copy; 2017 Pastebin; user contributions (pastes) licensed under <a href="http://creativecommons.org/licenses/by-sa/3.0/" target="_blank" rel="nofollow">cc by-sa 3.0</a> -- </span><a href="http://steadfast.net/services/dedicated-servers.php?utm_source=pastebin.com&amp;utm_medium=referral&amp;utm_content=footer_link_dedicated_server_hosting_by&amp;utm_campaign=referral_20140118_x_x_pastebin_partner&amp;source=referral_20140118_x_x_pastebin_partner" rel="nofollow" target="_blank">Dedicated Server Hosting</a> by <a href="http://steadfast.net/?utm_source=pastebin.com&amp;utm_medium=referral&amp;utm_content=footer_link_steadfast&amp;utm_campaign=referral_20140118_x_x_pastebin_partner&amp;source=referral_20140118_x_x_pastebin_partner" rel="nofollow" target="_blank">Steadfast</a>
			</div>
			<div id="footer_right" class="h_1024">
				<a href="https://facebook.com/pastebin" rel="nofollow" title="Like us on Facebook" target="_blank"><img src="/i/t.gif" alt="" class="icon40 facebook_circle" /></a>
				<a href="https://twitter.com/pastebin" rel="nofollow" title="Follow us on Twitter" target="_blank"><img src="/i/t.gif" alt="" class="icon40 twitter_circle" /></a>
			</div>
		</div>

			<script type="text/javascript"><!--
			  e9 = new Object();
			  e9.snackbar = true;
			//--></script>
			<script type="text/javascript" src="//tags.expo9.exponential.com/tags/Pastebincom/SnackbarSafe/tags.js"></script>
		<script type="text/javascript">
			function abdd() {$("#adb-enabled").show(), $("#adb-not-enabled").hide(), $("#abrpm3").html("<center><iframe src='/ablock/cube_safe.php' id='monkey_3' marginwidth='0' align='center' marginheight='0' hspace='0' vspace='0' frameborder='0' scrolling='no' allowtransparency='true' width='300' height='250' style='width: 300px; height: 250px;'></iframe></center>"), $("#abrpm2").html("<iframe src='/ablock/skyscraper_safe.php' id='monkey' marginwidth='0' align='center' marginheight='0' hspace='0' vspace='0' frameborder='0' scrolling='no' allowtransparency='true' width='160' height='600' style='width: 160px; height: 600px;'></iframe>"), $("#abrpm").html("<iframe src='/ablock/leaderboard_safe.php' id='monkey_2' marginwidth='0' align='center' marginheight='0' hspace='0' vspace='0' frameborder='0' scrolling='no' allowtransparency='true' width='728' height='100' style='width: 728px; height: 100px;'></iframe>")}
			function abnd(){$("#adb-enabled").hide(), $("#adb-not-enabled").show()}$(function(){}), "undefined" == typeof fuckAdBlock ? abdd() : (fuckAdBlock.setOption({debug: !1}), fuckAdBlock.onDetected(abdd).onNotDetected(abnd));
			var $title=$("a,input,p,label,textarea[title],img,button,span");$.each($title,function(){$(this).tooltip({show:{delay:1},hide:{delay:1}})});
		</script>		<script type="text/javascript">
			function isIE(){var e=navigator.userAgent.toLowerCase();return-1!=e.indexOf("msie")?parseInt(e.split("msie")[1]):!1}if(isIE()&&isIE()<10){var div=document.getElementById("ie_msg");div.innerHTML=div.innerHTML+'<div id="old_browser">Your browser is outdated and insecure! Pastebin does not offer support for your browser. <a href="http://outdatedbrowser.com/" target="_blank" rel="nofollow">Click here to update your browser</a>!</div>'}
		</script>
		<div class="pub_300x250"></div><a href="#0" class="cd-top">Top</a>
	</body>
</html>